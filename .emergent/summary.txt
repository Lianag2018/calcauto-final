<analysis>**original_problem_statement:**
The user's core objective is to perfect the CalcAuto AiPro application, a full-stack tool for vehicle financing. Initial requirements focused on OCR and a lease calculator. The scope has since evolved to include significant UI/UX enhancements, critical bug fixes, and major refactoring of the backend and frontend.

The most recent requests have focused on data presentation and user empowerment:
*   **(P0) Logical Trim Sorting:** A critical requirement to sort vehicle lists not alphabetically, but by a specific logical order defined by the manufacturer's official program documents.
*   **(P0) Admin Reordering:** A drag-and-drop interface for the user to manually adjust the vehicle sort order.
*   **(P1) Submission Consistency:** Ensuring that emails, SMS messages, and printed quotes are consistent and accurately reflect the selected vehicle's data (e.g., payment frequency, available financing options).
*   **(P0) Architecture Documentation & Independence:** The user now wants a complete breakdown of the application's architecture and a guide on how to deploy and manage it independently on their personal GitHub, Vercel, and Render accounts.

**PRODUCT REQUIREMENTS:**
*   **(P2) Refactor :** This monolithic frontend file is extremely large and complex. It needs to be broken down into smaller components and custom hooks. (Partially Completed - Further refactoring needed).
*   **(P2) Refactor :** Break this large file into smaller, more manageable components. (Not Started).
*   **(P0) Implement Logical Trim Sorting:** Vehicle lists must be sorted logically by trim level (e.g., Sport, North, Limited) as defined by the manufacturer/user, not alphabetically. (Completed).
*   **(P0) Create Admin Drag & Drop Sorting:** Allow the user to reorder vehicles via a UI. (Completed).
*   **(P0) Provide Architecture & Deployment Documentation:** Create a comprehensive guide for the user. (In Progress).

**User's preferred language**: French. The next agent MUST respond in French.

**what currently exists?**
A full-stack vehicle financing calculator (React/FastAPI) that is stable and feature-rich. In this session, the agent completed several critical user-facing features:
1.  **Logical Vehicle Sorting:** A complex sorting mechanism was implemented. A  field was added to the database, and a script was created to populate it based on the exact line-by-line order from an official PDF provided by the user. The frontend and backend now use this field, ensuring vehicles are always displayed in the correct, non-alphabetic order.
2.  **Admin Drag-and-Drop:** An Ordre véhicules tab was added to the admin panel, allowing the user to visually reorder vehicles. This writes the new order back to the database.
3.  **Submission Fixes:** Major bugs in email/SMS submissions were fixed. Rate tables are now generated dynamically (not hardcoded), and lease payment frequencies (weekly/monthly) are correctly displayed based on user selection. The SMS screenshot was also made larger and more legible.
4.  **Inventory Filter Fix:** A bug causing the inventory list to show incorrect models (e.g., showing Gladiators when a Compass was selected) has been resolved.

The application is functionally complete for the user's latest requests. The user is now asking for documentation to become self-sufficient.

**Last working item**:
*   **Last item agent was working:** The user requested a comprehensive document explaining the application's architecture (frontend, backend, database) and a step-by-step guide on how it is deployed to their personal GitHub, Vercel (frontend), and Render (backend) accounts. The goal is to make them fully independent of the Emergent platform.
*   **Status:** IN PROGRESS
*   **Agent Testing Done:** N/A
*   **Which testing method agent to use?** N/A (This is a documentation task).
*   **User Testing Done:** N

**All Pending/In progress Issue list**:
*   **Issue 1: Provide Full Architecture Documentation and Deployment Guide (P0)**
    *   **Description:** The user wants a complete explanation of the project structure and deployment pipeline so they can manage the application independently.
    *   **Attempted fixes:** The agent has acknowledged the request and begun exploring the codebase to gather the necessary information.
    *   **Next debug checklist:**
        1.  Create a new  or a similar documentation file in the root directory.
        2.  **Document Backend ():** Detail the FastAPI structure: , , , , and . Explain its connection to MongoDB via the  environment variable.
        3.  **Document Frontend ():** Detail the Expo/React for Web structure:  for screens, , and the critical  for backend communication.
        4.  **Document Deployment:**
            *   **GitHub:** Explain that code is stored in their  repositories.
            *   **Backend (Render):** Explain that Render deploys the  folder, runs , and starts the server with . List the required environment variables (, , , etc.).
            *   **Frontend (Vercel):** Explain that Vercel deploys the  folder and that the  environment variable must point to the Render backend URL.
        5.  **Present the document** to the user for review.
    *   **Why fix this issue and what will be achieved with the fix?** This will fulfill the user's ultimate goal of taking full ownership and control of their application.
    *   **Status:** IN PROGRESS
    *   **Is recurring issue?** N
    *   **Should Test frontend/backend/both after fix?** N/A
    *   **Blocked on other issue:** None.

**In progress Task List**:
*   There are no other in-progress tasks. The documentation is the sole focus.

**Upcoming and Future Tasks**
*   **Future Tasks:**
    *   **(P2) Complete Refactor of :** This file is still over 3,000 lines. The business logic for calculations should be extracted into custom hooks (e.g., ) to improve maintainability.
    *   **(P2) Refactor :** This large file should also be broken down into smaller components.
    *   **(P1) Verify Option 2 Data Across All Models:** Follow up with the user to confirm if any other vehicle models require data cleanup for the Option 2 financing rates.

**Completed work in this session**
- **Logical Trim Sorting (DONE):** Implemented a robust, PDF-aligned sorting for all vehicle lists using a new  database field.
- **Admin Drag & Drop UI (DONE):** Created a new admin section () with a drag-and-drop interface for the user to manually re-order vehicles.
- **Bug Fix: Inventory Filtering (DONE):** Fixed a bug where the calculator's inventory view showed vehicles from the wrong model.
- **Bug Fix: Submission Inconsistencies (DONE):**
    - Rewrote email templates to use dynamic data, fixing issues where incorrect financing options were displayed.
    - Corrected the SMS and screenshot generation to show the proper lease payment frequency (weekly/monthly).
    - Improved the legibility of the generated SMS screenshot by increasing its size and font.

**Earlier issues found/mentioned but not fixed**
*   None.

**Known issue recurrence from previous fork**
*   None.

**Code Architecture**


**Key Technical Concepts**
*   **Custom Data-Driven Sorting:** Implementing a non-alphabetic sort order based on an external document (PDF), storing it in the DB, and applying it across the stack.
*   **Drag-and-Drop UI:** Using  to create a stateful, user-driven reordering interface.
*   **Dynamic Template Generation:** Replacing hardcoded email/SMS content with dynamically generated data to ensure accuracy.
*   **API Endpoint Ordering:** Resolving a FastAPI routing conflict by reordering endpoint definitions.
*   **Frontend Build Process:** Diagnosing and fixing an issue where UI changes did not appear by forcing a rebuild of the static frontend assets.

**key DB schema**
*   ** collection:**
    *   : string
    *   : string
    *   : number
    *   : number (NEW, critical for display order)
    *   : Optional[Dict]
*   ** collection:** (Stores the canonical trim order per model)
    *   : string
    *   : string
    *   : number
    *   : List[string]

**All files of reference**
*   : New admin panel with drag-and-drop.
*   : Core file for calculator UI, vehicle list sorting, and SMS fixes.
*   : Contains the main vehicle data endpoint () and the new reordering endpoint ().
*   : Logic for generating dynamic submission emails.
*   : Component responsible for generating the quote image for SMS.
*   : One-off script used to populate the initial  data.

**Areas that need refactoring**:
*   ** (HIGH):** The file remains very large (3000+ lines) and would benefit greatly from being broken down into custom hooks and smaller components.
*   ** (MEDIUM):** Also a candidate for being split into smaller components.

**key api endpoints**
*   : Returns the list of all vehicle programs, now correctly sorted by .
*   : **NEW** endpoint that accepts an ordered list of program IDs to update their  in the database.
*   : Sends submission emails, now with a dynamically generated rate table.

**Critical Info for New Agent**
1.  **Parlez Français:** All communication with the user must be in French.
2.  **Top Priority (P0): Architecture Documentation:** The immediate and only active task is to create the architecture and deployment documentation requested by the user. This is a non-coding task. Do not start any other refactoring or feature work until this is complete and approved.
3.  **Do Not Change Sorting Logic:** The vehicle sorting is a critical feature that is now working exactly as the user wants. The user can manage the order themselves via the admin panel. Do not modify the underlying sorting code.
4.  **Admin Credentials:** The password  is used to authorize saving changes in the new admin panel.

**documents and test reports created in this job**
*    (From a previous test run in this session).

**Last 10 User Messages and any pending HUMAN messages**
1.  **user:** Asks for the total architecture of the application and how it's deployed to GitHub, Render, and Vercel, so they can be independent of Emergent. **(PENDING)**
2.  **user:** Requests a drag-and-drop interface in the admin panel to change the order of vehicles. (Completed)
3.  **user:** Reports that the lease payment frequency in SMS/screenshots doesn't match the selected frequency in the calculator. (Completed)
4.  **user:** Reports that the SMS image is too small and hard to read. (Completed)
5.  **user:** Points out that the email/SMS submission shows Option 2 rates for vehicles that don't have them. (Completed)
6.  **user:** Reports that when filtering for a Jeep Compass, the inventory list also shows Gladiator inventory. (Completed)
7.  **user:** Asks to align the vehicle sort order *exactly* with the incentive PDF they provided, line by line. (Completed)
8.  **user:** Asks the agent to proceed (go). (Acknowledged)
9.  **user:** Provides a new PDF with the official incentive programs to be used as the source of truth for sorting. (Acknowledged)
10. **user:** Mentions that the previous sorting was based on PDF options 1 and 2 and asks the agent to align with that. (Acknowledged)

**Project Health Check:**
*   **Broken:** None
*   **Mocked:** None

**3rd Party Integrations**
*   **html2canvas:** Used for generating quote screenshots for sharing.
*   **Google Cloud Vision:** Used for OCR on scanned invoices.
*   **OpenAI GPT-4o:** Used for structuring text extracted from invoices.
*   **openpyxl:** Python library for Excel file handling.
*   **PyMuPDF (fitz):** Python library for PDF parsing.
*   **react-beautiful-dnd:** **NEW** library used for the drag-and-drop admin interface.

**Testing status**
*   **Testing agent used after significant changes:** YES (earlier in the session for the initial sorting feature).
*   **Troubleshoot agent used after agent stuck in loop:** NO
*   **Test files created:** None.
*   **Known regressions:** None.

**Credentials to test flow:**
*   **User Login:**  / 
*   **Admin Password (for saving in admin panel):** 

**What agent forgot to execute**
*   The original plan to completely refactor  by extracting business logic into custom hooks has not been completed and remains a future task.</analysis>
